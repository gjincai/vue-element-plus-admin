import{d as e,F as s}from"./Form-1e4bda88.js";import{u as a}from"./useForm-4fdd48d6.js";import{u as o}from"./useValidator-5852dc3b.js";import{d as l,r as t,e as r,a as i,F as n,q as u,M as m,o as d,i as c,k as p,N as f,bK as v}from"./index-c87642b8.js";import{e as b,E as h}from"./tsxHelper-3d63d233.js";import{g as x}from"./index-245cda17.js";import{e as w,f as g}from"./tree-b59d36bb.js";const j=l({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(l,{expose:j}){const k=l,{t:R}=p(),{required:y}=o(),F=t(),N=t([{field:"roleName",label:R("role.roleName"),component:"Input"},{field:"role",label:R("role.role"),component:"Input"},{field:"status",label:R("menu.status"),component:"Select",componentProps:{options:[{label:R("userDemo.disable"),value:0},{label:R("userDemo.enable"),value:1}]}},{field:"menu",label:R("role.menu"),colProps:{span:24},formItemProps:{slots:{default:()=>{var s;return r(n,null,[r("div",{class:"flex w-full"},[r("div",{class:"flex-1"},[r(e,{ref:F,"show-checkbox":!0,"node-key":"id","highlight-current":!0,"check-strictly":!0,"expand-on-click-node":!1,data:K.value,"onNode-click":D},{default:e=>r("span",null,[e.data.meta.title])})]),r("div",{class:"flex-1"},[i(V)&&(null==(s=i(V))?void 0:s.permission)?r(b,{modelValue:i(V).meta.permission,"onUpdate:modelValue":e=>i(V).meta.permission=e},{default:()=>{var e;return[null==(e=i(V))?void 0:e.permission.map((e=>r(h,{label:e},null)))]}}):null])])])}}}}]),V=t(),D=e=>{V.value=e},E=u({roleName:[y()],role:[y()],status:[y()]}),{formRegister:I,formMethods:P}=a(),{setValues:_,getFormData:q,getElFormExpose:C}=P,K=t([]);(async()=>{var e;const s=await x();if(s){if(K.value=s.data.list,!k.currentRow)return;await f();const a=[];w(k.currentRow.menu,(e=>{var s;a.push({id:e.id,permission:(null==(s=e.meta)?void 0:s.permission)||[]})})),w(K.value,(e=>{const s=v(a,(s=>s.id===e.id));if(s>-1){const o={...e.meta||{}};o.permission=a[s].permission,e.meta=o}}));for(const s of a)null==(e=i(F))||e.setChecked(s.id,!0,!1)}})();return m((()=>k.currentRow),(e=>{e&&_(e)}),{deep:!0,immediate:!0}),j({submit:async()=>{var e;const s=await C();if(await(null==s?void 0:s.validate().catch((e=>{})))){const s=await q(),a=(null==(e=i(F))?void 0:e.getCheckedKeys())||[],o=g(i(K),(e=>a.includes(e.id)));return s.menu=o||[],s}}}),(e,a)=>(d(),c(i(s),{rules:E,onRegister:i(I),schema:N.value},null,8,["rules","onRegister","schema"]))}});export{j as _};
