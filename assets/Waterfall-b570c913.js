import{d as e,O as t,r as a,M as s,D as l,a as r,a1 as o,a2 as i,o as n,c as d,f as u,F as p,B as f,W as h,t as c,n as g,j as m,N as v,i as x,w as _,e as w,a3 as y,a4 as $,k as b}from"./index-c87642b8.js";import{d as j}from"./debounce-e5c60c2d.js";import{_ as M}from"./ContentWrap.vue_vue_type_script_setup_true_lang-0a3f8e4e.js";import"./el-card-b38eccf1.js";import"./el-popper-4d097879.js";import"./constants-46f1a00c.js";const k=["src"],T=e({__name:"Waterfall",props:{data:t.arrayOf(t.any),reset:t.bool.def(!0),width:t.number.def(200),gap:t.number.def(20),props:t.objectOf(t.string).def({src:"src",height:"height"}),loadingText:t.string.def("加载中..."),loading:t.bool.def(!1),end:t.bool.def(!1),endText:t.string.def("没有更多了")},emits:["loadMore"],setup(e,{emit:t}){const x=e,{getPrefixCls:_}=m(),w=_("waterfall"),y=a(),$=a([]),b=a(0),M=a(0),T=a(),W=a(0),O=a([]),R=async()=>{O.value=[];const{props:e,width:t,gap:a}=x,s=x.data;await v();const l=r(y);if(!l)return;W.value=Math.floor(l.clientWidth/(t+a));const o=s.length;for(let i=0;i<o;i++)if(i<r(W))$.value[i]=s[i][e.height],O.value.push({...s[i],top:0,left:i*(t+a)});else{let l=$.value[0],o=0;for(let e=1;e<r(W);e++)r($)[e]<l&&(l=r($)[e],o=e);$.value[o]+=s[i][e.height]+a,O.value.push({...s[i],top:l+a,left:o*(t+a)})}b.value=Math.max(...r($)),M.value=r(W)*(t+a)-a};return s((()=>x.data),(async()=>{await v(),R()}),{immediate:!0}),l((()=>{r(x.reset)&&o(window,"resize",j(R,300)),i(r(T),(([{isIntersecting:e}])=>{!e||x.loading||x.end||t("loadMore")}),{threshold:.1})})),(t,a)=>(n(),d("div",{class:g([r(w),"flex","justify-center","items-center"]),ref_key:"wrapEl",ref:y,style:h({height:`${b.value+40}px`})},[u("div",{class:"relative",style:h({width:`${M.value}px`,height:`${b.value+40}px`})},[(n(!0),d(p,null,f(O.value,((t,a)=>(n(),d("div",{class:g([`${r(w)}-item__${a}`,"absolute"]),key:`water-${a}`,style:h({width:`${e.width}px`,height:`${t[e.props.height]}px`,top:`${t.top}px`,left:`${t.left}px`})},[u("img",{src:t[e.props.src],class:"w-full h-full block",alt:"",srcset:""},null,8,k)],6)))),128)),u("div",{ref_key:"loadMore",ref:T,class:"h-40px flex justify-center absolute w-full",style:h({top:`${b.value+e.gap}px`})},c(e.end?e.endText:e.loadingText),5)],4)],6))}}),W=e({__name:"Waterfall",setup(e){const t=a([]),s=()=>{const e=[];for(let t=0;t<20;t++){const t=y.Random.integer(100,500),a=y.Random.integer(100,500);e.push(y.mock({width:a,height:t,id:$(),image_uri:y.Random.image(`${a}x${t}`)}))}t.value=[...r(t),...e],r(t).length>=60&&(i.value=!0)};s();const{t:l}=b(),o=a(!1),i=a(!1),d=()=>{o.value=!0,setTimeout((()=>{s(),o.value=!1}),1e3)};return(e,a)=>(n(),x(r(M),{title:r(l)("router.waterfall")},{default:_((()=>[w(r(T),{data:t.value,loading:o.value,end:i.value,props:{src:"image_uri",height:"height"},onLoadMore:d},null,8,["data","loading","end"])])),_:1},8,["title"]))}});export{W as default};
